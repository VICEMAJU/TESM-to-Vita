name: Construyendo MyGUI (Corregido)

on: [push, workflow_dispatch]

jobs:
  build-mygui:
    runs-on: ubuntu-latest
    container: vitasdk/vitasdk:latest

    steps:
      - name: Instalar herramientas
        # Intentamos instalar dependencias básicas si faltan
        # Si falla apk, usamos apt-get por si acaso la imagen es Ubuntu
        run: |
          if command -v apk; then apk add --no-cache cmake ninja git; \
          else apt-get update && apt-get install -y cmake ninja-build git; fi

      - name: Descargar MyGUI (Oficial)
        # CORRECCION: Usamos el repo oficial, no el inventado
        run: git clone --depth 1 https://github.com/MyGUI/mygui.git mygui_src

      - name: Configurar MyGUI para Vita
        run: |
          mkdir mygui_build
          cd mygui_build
          cmake ../mygui_src \
            -DCMAKE_TOOLCHAIN_FILE="$VITASDK/share/kds/cmake/Toolchain-PSVita.cmake" \
            -DCMAKE_BUILD_TYPE=Release \
            -DMYGUI_RENDERSYSTEM=1 \
            -DMYGUI_BUILD_DEMOS=OFF \
            -DMYGUI_BUILD_TOOLS=OFF \
            -DMYGUI_BUILD_PLUGINS=OFF \
            -DMYGUI_USE_FREETYPE=OFF \
            -G "Ninja"
          # Nota: Desactivé FreeType temporalmente para evitar otro error si falta esa librería.
          # Primero queremos ver si compila el código base.

      - name: Compilar
        run: cmake --build mygui_build

      - name: Verificar éxito
        run: ls -lh mygui_build/lib/libMyGUIEngine.a
