name: Construyendo MyGUI (Intento 2)

on: [push, workflow_dispatch]

jobs:
  build-mygui:
    runs-on: ubuntu-latest
    container: vitasdk/vitasdk:latest

    steps:
      - name: Instalar Make y Git
        # Instalamos 'make' que es el constructor cl√°sico
        run: apk add --no-cache make git cmake

      - name: üïµÔ∏è‚Äç‚ôÇÔ∏è ESPIONAJE - Buscar el Toolchain
        # Este comando buscar√° cualquier archivo .cmake dentro de la carpeta del SDK
        # As√≠ sabremos la ruta exacta si volvemos a fallar
        run: find $VITASDK -name "*.cmake"

      - name: Descargar MyGUI (Oficial)
        run: git clone --depth 1 https://github.com/MyGUI/mygui.git mygui_src

      - name: Configurar MyGUI
        run: |
          mkdir mygui_build
          cd mygui_build
          # CAMBIO IMPORTANTE:
          # 1. Usamos la ruta moderna: $VITASDK/share/vitasdk.cmake
          # 2. Quitamos -G "Ninja" para que use Make por defecto
          cmake ../mygui_src \
            -DCMAKE_TOOLCHAIN_FILE="$VITASDK/share/vitasdk.cmake" \
            -DCMAKE_BUILD_TYPE=Release \
            -DMYGUI_RENDERSYSTEM=1 \
            -DMYGUI_BUILD_DEMOS=OFF \
            -DMYGUI_BUILD_TOOLS=OFF \
            -DMYGUI_BUILD_PLUGINS=OFF \
            -DMYGUI_USE_FREETYPE=OFF 

      - name: Compilar
        run: cmake --build mygui_build

      - name: Verificar √©xito
        run: ls -lh mygui_build/lib/libMyGUIEngine.a
