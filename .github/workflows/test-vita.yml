name: Intento 5 - Instalacion Manual

on: [push, workflow_dispatch]

jobs:
  build-mygui:
    runs-on: ubuntu-latest
    container: vitasdk/vitasdk:latest

    steps:
      - name: 1. Instalar Make y Wget (Manual)
        run: |
          # Instalamos Make (para compilar) y Wget (para descargar archivos)
          apk update && apk add --no-cache make cmake git wget

      - name: 2. Descargar c√≥digo MyGUI
        run: git clone --depth 1 https://github.com/MyGUI/mygui.git mygui_src

      - name: 3. üì• BAJAR Toolchain Manualmente
        run: |
          # Aqu√≠ est√° tu idea: Descargamos el archivo nosotros mismos.
          # Lo guardamos como 'vita.cmake' en la carpeta actual.
          wget https://raw.githubusercontent.com/vitasdk/buildscripts/master/cmake/Toolchain-PSVita.cmake -O vita.cmake
          
          # Hacemos una correcci√≥n manual dentro del archivo por si acaso
          # Esto asegura que busque las librer√≠as en la carpeta correcta del sistema
          sed -i 's|/usr/local/vitasdk|$ENV{VITASDK}|g' vita.cmake
          
          echo "‚úÖ Archivo de configuraci√≥n descargado y listo."

      - name: 4. Configurar y Compilar
        run: |
          mkdir mygui_build
          cd mygui_build

          # Le decimos a CMake: Usa el archivo "vita.cmake" que baj√© en el paso anterior
          cmake ../mygui_src \
            -DCMAKE_TOOLCHAIN_FILE="../vita.cmake" \
            -DCMAKE_BUILD_TYPE=Release \
            -DMYGUI_RENDERSYSTEM=1 \
            -DMYGUI_BUILD_DEMOS=OFF \
            -DMYGUI_BUILD_TOOLS=OFF \
            -DMYGUI_BUILD_PLUGINS=OFF \
            -DMYGUI_USE_FREETYPE=OFF \
            -G "Unix Makefiles"

          # Compilar
          make -j$(nproc)

      - name: 5. Verificar √âxito
        run: ls -lh mygui_build/lib/libMyGUIEngine.a
