name: Construyendo Dependencias (MyGUI)

on: [push, workflow_dispatch]

jobs:
  build-mygui:
    runs-on: ubuntu-latest
    container: vitasdk/vitasdk:latest

    steps:
      # 1. Preparar herramientas básicas (CMake y Ninja son los albañiles)
      - name: Instalar herramientas de construcción
        run: apk add --no-cache cmake ninja git

      # 2. Descargar el código fuente de MyGUI (Versión especial para Vita)
      # Usamos un "fork" que ya se sabe que funciona en Vita para no sufrir tanto al principio
      - name: Clonar MyGUI (Port de Vita)
        run: git clone --depth 1 https://github.com/vitasdk/mygui.git mygui_src

      # 3. Configurar la compilación (La parte difícil)
      # Le decimos a CMake: "No compiles para Linux, compila para VITA usando este Toolchain"
      - name: Configurar MyGUI con CMake
        run: |
          mkdir mygui_build
          cd mygui_build
          cmake ../mygui_src \
            -DCMAKE_TOOLCHAIN_FILE="$VITASDK/share/kds/cmake/Toolchain-PSVita.cmake" \
            -DCMAKE_BUILD_TYPE=Release \
            -DMYGUI_RENDERSYSTEM=1 \
            -DMYGUI_BUILD_DEMOS=OFF \
            -DMYGUI_BUILD_TOOLS=OFF \
            -DMYGUI_BUILD_PLUGINS=OFF \
            -G "Ninja"

      # 4. ¡Compilar! (El momento de la verdad)
      - name: Compilar MyGUI
        run: cmake --build mygui_build

      # 5. Verificar si nació la librería
      - name: ¿Se creó el archivo?
        run: ls -lh mygui_build/lib/libMyGUIEngine.a
